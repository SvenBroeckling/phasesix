{% load characters_extras rules_extras i18n static %}
<html lang="de">
<head>
    <title>{% trans 'Phase Six Core Rulebook' %}</title>

    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;1,300&display=swap"
          rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css" type="text/css"
          rel="stylesheet"/>

    <style>
        @page {
            size: A4;
            margin: 1cm;
        }

        body {
            box-sizing: border-box;
            padding: 0;
            margin: 0;
            font-size: 0.9rem;
            font-family: 'Merriweather';
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Roboto';
        }

        .text-end {
            text-align: end;
        }

        .text-muted {
            color: #333;
        }

        small {
            font-size: 7pt;
        }

        header {
            margin-bottom: 0.5cm;
        }

        header h1 {
            margin: 0;
        }

        section.shadows,
        section.attributes,
        section.skills {
            display: flex;
            align-items: flex-start;
            padding: 0.2cm;
        }

        section.attributes > *,
        section.skills > * {
            flex-basis: 100%;
        }

        section.attributes table,
        section.skills table {
            width: 100%;
        }

        section.skills table th,
        section.attributes table th {
            font-weight: bold;
        }

        section.shadows div.card {
            padding: 0 0.3cm;
            margin-right: 0.2cm;
            border: 1px solid silver;
        }
        section.shadows div.card h4 {
            margin-bottom: 0;
        }

        section.shadows div.card ul {
            padding-left: 0.2cm;
        }

    </style>
</head>

<body>

<header>
    <h1>{{ object.name }}</h1>
    <small class="text-muted">{{ object.lineage }}</small> -
    <small class="text-muted">{% template_category_string object 3 '' %}</small> -
    <small class="text-muted">{% template_category_string object 2 '' %}</small>
</header>

<section class="attributes">
    <div class="persona">
        <table>
            <thead>
            <tr>
                <th>{% trans 'Persona' %}</th>
                <th class="text-end">{% trans 'Dice' %}</th>
            </tr>
            </thead>
            <tbody>
            {% for attribute in object.characterattribute_set.persona_attributes %}
                <tr>
                    <td>{{ attribute.attribute.name }}</td>
                    <td class="text-end">{% color_value_span attribute.value 7 %}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="physis">
        <table>
            <thead>
            <tr>
                <th>{% trans 'Physis' %}</th>
                <th class="text-end">{% trans 'Dice' %}</th>
            </tr>
            </thead>
            <tbody>
            {% for attribute in object.characterattribute_set.physis_attributes %}
                <tr>
                    <td>{{ attribute.attribute.name }}</td>
                    <td class="text-end">{% color_value_span attribute.value 7 %}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="knowledge">
        {% if object.knowledge_dict %}
            <table class="table">
                <thead>
                <tr>
                    <th>{% trans 'Knowledge' %}</th>
                    <th class="text-end">{% trans 'Dice' %}</th>
                </tr>
                </thead>
                {% for knowledge in object.knowledge_dict.items %}
                    <tr class="sidebar-trigger" data-sidebar-title="{{ knowledge.0 }}" data-sidebar-url="{% url 'characters:xhr_characterknowledge_sidebar' pk=object.id sidebar_template="characterknowledge" knowledge_pk=knowledge.0.id %}">
                        <td>
                            {{ knowledge.0 }}
                            {% if knowledge.0.skill %}
                                <br>
                                <small class="text-muted">({{ knowledge.0.skill }})</small>
                            {% endif %}
                        </td>
                        <td class="text-end">
                            {% color_value_span knowledge.1 6 %}
                            {% if knowledge.0.skill %}
                                {% character_knowledge_skill_value object knowledge.0 as cs %}
                                + {% color_value_span cs 6 %}
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </table>
        {% endif %}
    </div>

</section>

<section class="skills">
    <div>
        <table class="table">
            <thead>
            <tr>
                <th>{% trans 'Skills' %}</th>
                <th class="text-end">{% trans 'Dice' %}</th>
            </tr>
            </thead>
            {% for skill in object.skills.mind_skills %}
                <tr class="sidebar-trigger" data-sidebar-title="{{ skill.skill }}" data-sidebar-url="{% url 'characters:xhr_characterskill_sidebar' pk=skill.id sidebar_template="characterskill" %}">
                    <td>
                        {{ skill.skill }}
                        <small class="text-muted">({{ skill.skill.reference_attribute_1.name }}, {{ skill.skill.reference_attribute_2.name }})</small>
                    </td>
                    <td class="text-end">{% color_value_span skill.value 7 %}</td>
                </tr>
            {% endfor %}
        </table>
    </div>

    <div>
        <table class="table">
            <thead>
            <tr>
                <th>{% trans 'Skills' %}</th>
                <th class="text-end">{% trans 'Dice' %}</th>
            </tr>
            </thead>
            {% for skill in object.skills.practical_skills %}
                <tr class="sidebar-trigger" data-sidebar-title="{{ skill.skill }}" data-sidebar-url="{% url 'characters:xhr_characterskill_sidebar' pk=skill.id sidebar_template="characterskill" %}">
                    <td>
                        {{ skill.skill }}
                        <small class="text-muted">({{ skill.skill.reference_attribute_1.name }}, {{ skill.skill.reference_attribute_2.name }})</small>
                    </td>
                    <td class="text-end">{% color_value_span skill.value 7 %}</td>
                </tr>
            {% endfor %}
        </table>
    </div>
</section>

{% if object.templates_with_rules.exists %}
    <h2>Shadows</h2>
    <section class="shadows">
        {% for template in object.templates_with_rules.all %}
            <div class="card">
                <h4>{{ template.template.name }}</h4>
                <small>
                    {{ template.template.rules|urpg_markup }}
                </small>
            </div>
        {% endfor %}
    </section>
{% endif %}

</body>
</html>
