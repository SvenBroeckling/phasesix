{% load characters_extras rules_extras i18n %}
<div class="row">
    <div class="col-md-4">
        <h2 class="text-center">- {% trans 'Actions' %} -</h2>
        <table class="table">
            <table class="table">
                <tr>
                    <td>{% trans 'Actions' %}</td>
                    <td class="text-right">{% color_value_span object.actions 5 %}</td>
                </tr>
                <tr>
                    <td>{% trans 'Bonus Dice' %} ({% trans 'Bonus Action' %})</td>
                    <td class="text-right">{% color_value_span object.bonus_dice 6 %}</td>
                </tr>
                <tr>
                    <td>{% trans 'Destiny Dice' %} ({% trans 'Steal Action' %})</td>
                    <td class="text-right">{% color_value_span object.destiny_dice 6 %}</td>
                </tr>
            </table>
        </table>

        <h2 class="text-center">- {% trans 'Skills' %} -</h2>
        <table class="table">
            {% for skill in object.characterskill_set.combat_skills %}
                <tr>
                    <td>{{ skill.skill }}</td>
                    <td class="text-right">{% color_value_span skill.value 6 %}</td>
                </tr>
            {% endfor %}
        </table>

        <h2 class="text-center">- {% trans 'Rolls' %} -</h2>
        <table class="table">
            <tr>
                <td>{% trans 'Attack Roll' %}</td>
                <td>7 - {% trans 'Skill' %} - {% trans 'Weapon Accuracy' %}</td>
            </tr>
            <tr>
                <td>{% trans 'Cover Roll' %}</td>
                <td>
                    4+ - {% trans 'Mostly covered' %}<br>
                    5+ - {% trans 'Half cover' %}<br>
                    6+ - {% trans 'Minimal cover' %}
                </td>
            </tr>
            <tr>
                <td>{% trans 'Armor roll' %}</td>
                <td>7 - {% trans 'Armor value' %} + {% trans 'penetration' %}</td>
            </tr>
        </table>
    </div>

    <div class="col-md-8 mb-4">
        <div class="dropdown">
            <h2 data-toggle="dropdown" class="mb-1 text-center touch-menu">- {% trans 'Weapons' %} -</h2>
            <div class="dropdown-menu">
                <a
                        class="dropdown-item modal-trigger-link"
                        data-url="{% url 'characters:xhr_add_weapons' pk=object.id %}"
                        data-toggle="modal"
                        data-target=".character-modal"
                        data-modal-title="{% trans 'Add Weapon' %}"
                        href=""><i class="fas fa-plus text-info"></i> {% trans 'Add Weapon' %}</a>
            </div>
        </div>

        <div class="row">
            {% for weapon in object.characterweapon_set.all %}
                <div class="col-md-12 dropdown">
                    <div class="card mb-2 touch-menu" data-toggle="dropdown">
                        <div class="card-header">
                            <i class="{{ weapon.weapon.extension.fa_icon_class }}" title="{{ weapon.weapon.extension }}"></i>
                            {{ weapon.weapon }}
                            <span class="float-right small">{{ weapon.weapon.type }}</span>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <i class="fas fa-times fa-fw"></i> {% trans 'Attacks / Action' %}: {% color_value_span weapon.weapon.attacks_per_action 8 %} {% display_modifications weapon 'attacks_per_action' %}<br>
                                    <i class="fas fa-bullseye fa-fw"></i> {% trans 'Accuracy' %}: {% color_value_span weapon.weapon.accuracy 4 %} {% display_modifications weapon 'accuracy' %}<br>
                                    <i class="fas fa-angle-double-right fa-fw"></i> {% trans 'Penetration' %}: {% color_value_span weapon.weapon.penetration 4 %} {% display_modifications weapon 'penetration' %}<br>
                                    <i class="fas fa-heart fa-fw"></i> {% trans 'Wounds' %}: {% color_value_span weapon.weapon.wounds 4 %} {% display_modifications weapon 'wounds' %}<br>
                                    {% if not weapon.weapon.is_hand_to_hand_weapon %}
                                        <i class="fas fa-clock fa-fw"></i> {% trans 'Reload actions' %}: {% color_value_span weapon.weapon.reload_actions 6 invert=True %} {% display_modifications weapon 'reload_actions' %}<br>
                                        <i class="fas fa-arrow-circle-left fa-fw"></i> {% trans 'Recoil control' %}: {% color_value_span weapon.weapon.recoil_control 4 %} {% display_modifications weapon 'recoil_control' %}<br>
                                    {% endif %}
                                    <i class="fas fa-arrows-alt-h fa-fw"></i> {% trans 'Range' %}: {{ weapon.weapon.get_range_lower_display }}
                                    {% if weapon.weapon.range_upper and weapon.weapon.range_upper != weapon.weapon.range_lower %}-
                                        {{ weapon.weapon.get_range_upper_display }}{% endif %}<br>
                                </div>
                                <div class="col-md-6">
                                    <i class="fas fa-eye-slash fa-fw"></i> {% trans 'Concealment' %}: {% color_value_span weapon.weapon.concealment 7 invert=True %} {% display_modifications weapon 'concealment' %}<br>
                                    <i class="fas fa-balance-scale fa-fw"></i> {% trans 'Weight' %}: {{ weapon.weapon.weight }} {% display_modifications weapon 'weight' %}<br>
                                    {% if not weapon.weapon.is_hand_to_hand_weapon %}
                                        <i class="fas fa-list-ol fa-fw"></i> {% trans 'Capacity' %}: {% color_value_span weapon.weapon.capacity 30 %}<br>
                                    {% endif %}
                                    {% if weapon.weapon.attack_modes.exists %}
                                        <br>
                                        {% for fm in weapon.weapon.attack_modes.all %}{{ fm }}<br>{% endfor %}
                                    {% endif %}
                                    {% if weapon.modifications.exists %}
                                        <br><br>
                                        {% for wm in weapon.modifications.all %}
                                            {{ wm }}<br>
                                        {% endfor %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="dropdown-menu">
                        <a
                                class="dropdown-item modal-trigger-link"
                                data-url="{% url 'characters:xhr_add_weapon_modifications' pk=object.id %}?weapon_id={{ weapon.id }}"
                                data-toggle="modal"
                                data-target=".character-modal"
                                data-modal-title="{% trans 'Add Modification' %}"
                                href=""><i class="fas fa-plus text-info"></i> {% trans 'Add Modification' %}</a>
                        <a class="dropdown-item" href="#"><i class="fas fa-times text-warning"></i> {% trans 'Damage' %}</a>
                        <a class="dropdown-item" href="#"><i class="fas fa-trash text-danger"></i> {% trans 'Remove' %}</a>
                        <div class="dropdown-divider"></div>
                        <a
                                class="dropdown-item modal-trigger-link"
                                data-url="{% url 'characters:xhr_add_weapons' pk=object.id %}"
                                data-toggle="modal"
                                data-target=".character-modal"
                                data-modal-title="{% trans 'Add Weapon' %}"
                                href=""><i class="fas fa-plus text-info"></i> {% trans 'Add Weapon' %}</a>
                    </div>
                </div>
            {% empty %}
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            {% trans 'Weapons' %}
                        </div>
                        <div class="card-body">
                            <h2>{% trans 'No weapons yet' %}</h2>
                            <p>{% trans 'This character has no weapons yet.' %}</p>
                            <button
                                    class="btn btn-primary buy-button float-right"
                                    data-url="{% url 'characters:xhr_add_weapons' pk=object.id %}"
                                    data-toggle="modal"
                                    data-modal-title="{% trans 'Add weapon' %}"
                                    data-target=".character-modal">{% trans 'Add weapon' %}</button>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</div>


