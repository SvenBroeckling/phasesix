{% extends 'characters/fragments/fragment_base.html' %}
{% load characters_extras rules_extras i18n %}

{% block fragment %}

    <div class="row">
        <div class="col-md-6">
            <div>
                {% if may_edit %}
                <a
                        class="btn btn-primary btn-sm float-right modal-trigger"
                        data-url="{% url 'characters:xhr_add_riot_gear' pk=object.id %}"
                        data-toggle="modal"
                        data-target=".character-modal"
                        data-modal-title="{% trans 'Add Armor' %}"
                        href=""><i class="fas fa-plus"></i></a>
                {% endif %}
                <h2 class="mb-2">{% trans 'Armor' %}</h2>
            </div>

            <div class="card mb-4">
                <ul class="list-group list-group-flush">
                    {% for r in character.characterriotgear_set.all %}
                    <li class="list-group-item">
                        <a
                                tabindex="0"
                                role="button"
                                data-toggle="popover"
                                data-html="true"
                                data-trigger="focus"
                                data-title="{{ r.riot_gear }}"
                                data-content='<i class="fas fa-shield-alt fa-fw"></i> {% trans 'Protection' %}: {% color_value_span r.riot_gear.protection_ballistic 7 %}/{% color_value_span r.riot_gear.protection_explosive 7 %}<br>
                    <i class="fas fa-eye-slash fa-fw"></i> {% trans 'Concealment' %}: {% color_value_span r.riot_gear.concealment 6 invert=True %}<br>
                    <i class="fas fa-balance-scale fa-fw"></i> {% trans 'Weight' %}: {{ r.riot_gear.weight }}<br>
                    <i class="fas fa-asterisk fa-fw"></i> {% trans 'Condition' %}: {% color_value_span r.condition 100 %}'
                                data-container="body">{{ r.riot_gear }}</a>

                        {% if may_edit %}
                        <a class="float-right action-link text-danger ml-1" title="{% trans 'Remove' %}" href="{% url 'characters:xhr_remove_riot_gear' pk=object.id riot_gear_pk=r.id %}"><i class="fas fa-trash"></i></a>
                        <a class="float-right action-link text-warning ml-3" title="{% trans 'Damage' %}" href="{% url 'characters:xhr_damage_riot_gear' pk=object.id riot_gear_pk=r.id %}"><i class="fas fa-times"></i></a>
                        {% endif %}

                        <span class="float-right">{% color_value_span r.condition 100 %}%</span>
                    </li>
                    {% empty %}
                        <li class="list-group-item">
                            <a
                                    class="modal-trigger"
                                    data-url="{% url 'characters:xhr_add_riot_gear' pk=object.id %}"
                                    {% if may_edit %}
                                    data-toggle="modal"
                                    {% endif %}
                                    data-target=".character-modal"
                                    data-modal-title="{% trans 'Add Armor' %}"
                                    href="">{% trans 'No armor yet.' %}</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>

            <div>
                {% if may_edit %}
                <a
                        class="btn btn-primary btn-sm float-right modal-trigger"
                        data-url="{% url 'characters:xhr_add_weapons' pk=object.id %}"
                        data-toggle="modal"
                        data-target=".character-modal"
                        data-modal-title="{% trans 'Add Weapon' %}"
                        href=""><i class="fas fa-plus"></i></a>
                {% endif %}
                <h2 class="mb-2">{% trans 'Weapons' %}</h2>
            </div>
            <div class="card mb-2">
                <ul class="list-group list-group-flush">
                    {% for weapon in object.characterweapon_set.all %}
                        <li class="list-group-item">
                            <a
                                    tabindex="0"
                                    role="button"
                                    data-toggle="popover"
                                    data-html="true"
                                    data-trigger="focus"
                                    data-title="{{ weapon.weapon }}"
                                    data-content='
                    <div class="row">
                        <div class="col-md-6">
                            <i class="fas fa-times fa-fw"></i> {% trans 'Attacks / Action' %}: {% color_value_span weapon.weapon.attacks_per_action 8 %} {% display_modifications weapon 'attacks_per_action' %}<br>
                            <i class="fas fa-bullseye fa-fw"></i> {% trans 'Accuracy' %}: {% color_value_span weapon.weapon.accuracy 4 %} {% display_modifications weapon 'accuracy' %}<br>
                            <i class="fas fa-angle-double-right fa-fw"></i> {% trans 'Penetration' %}: {% color_value_span weapon.weapon.penetration 4 %} {% display_modifications weapon 'penetration' %}<br>
                            <i class="fas fa-heart fa-fw"></i> {% trans 'Wounds' %}: {% color_value_span weapon.weapon.wounds 4 %} {% display_modifications weapon 'wounds' %}<br>
                            {% if not weapon.weapon.is_hand_to_hand_weapon %}
                                <i class="fas fa-clock fa-fw"></i> {% trans 'Reload actions' %}: {% color_value_span weapon.weapon.reload_actions 6 invert=True %} {% display_modifications weapon 'reload_actions' %}<br>
                                <i class="fas fa-arrow-circle-left fa-fw"></i> {% trans 'Recoil control' %}: {% color_value_span weapon.weapon.recoil_control 4 %} {% display_modifications weapon 'recoil_control' %}<br>
                            {% endif %}
                            <i class="fas fa-arrows-alt-h fa-fw"></i> {% trans 'Range' %}: {{ weapon.weapon.get_range_lower_display }}
                            {% if weapon.weapon.range_upper and weapon.weapon.range_upper != weapon.weapon.range_lower %}-
                                {{ weapon.weapon.get_range_upper_display }}{% endif %}<br>
                        </div>
                        <div class="col-md-6">
                            <i class="fas fa-eye-slash fa-fw"></i> {% trans 'Concealment' %}: {% color_value_span weapon.weapon.concealment 7 invert=True %} {% display_modifications weapon 'concealment' %}<br>
                            <i class="fas fa-balance-scale fa-fw"></i> {% trans 'Weight' %}: {{ weapon.weapon.weight }} {% display_modifications weapon 'weight' %}<br>
                            {% if not weapon.weapon.is_hand_to_hand_weapon %}
                                <i class="fas fa-list-ol fa-fw"></i> {% trans 'Capacity' %}: {% color_value_span weapon.weapon.capacity 30 %}<br>
                            {% endif %}
                            <br>
                            <i class="fas fa-wrench fa-fw"></i> {% trans 'Condition' %}: {% color_value_span weapon.condition 100 %}<br>
                            {% if weapon.weapon.attack_modes.exists %}
                                <br>
                                {% for fm in weapon.weapon.attack_modes.all %}{{ fm }}<br>{% endfor %}
                            {% endif %}
                            {% if weapon.modifications.exists %}
                                <br><br>
                                {% for wm in weapon.modifications.all %}
                                    {{ wm }}<br>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>'
                                    data-container="body">
                                {{ weapon.weapon }} <span class="small text-muted">{{ weapon.weapon.type }}</span>
                            </a>

                            {% if may_edit %}
                                {% has_valid_weaponmodifications weapon.weapon object as has_valid_wm %}
                                {% if has_valid_wm %}
                                    <a
                                            class="modal-trigger float-right ml-1 {% if not has_valid_wm %}disabled{% endif %}"
                                            data-url="{% url 'characters:xhr_add_weapon_modifications' pk=object.id %}?weapon_id={{ weapon.id }}"
                                            title="{% trans 'Add Modification' %}"
                                            data-toggle="modal"
                                            data-target=".character-modal"
                                            data-modal-title="{% trans 'Add Modification' %}"
                                            href=""><i class="fas fa-plus text-info"></i></a>
                                {% endif %}
                                <a class="float-right action-link text-danger ml-1" title="{% trans 'Remove' %}" href="{% url 'characters:xhr_remove_weapon' pk=object.id weapon_pk=weapon.id %}"><i class="fas fa-trash"></i></a>
                                <a class="float-right action-link text-warning ml-3" title="{% trans 'Damage' %}" href="{% url 'characters:xhr_damage_weapon' pk=object.id weapon_pk=weapon.id %}"><i class="fas fa-times"></i></a>
                            {% endif %}

                            <span class="float-right">{% color_value_span weapon.condition 100 %}%</span>
                            {% for wm in weapon.modifications.all %}<span class="badge badge-info mr-1 float-right small">{{ wm }}</span>{% endfor %}
                        </li>
                    {% empty %}
                        <li class="list-group-item">
                            <a
                                    class="modal-trigger"
                                    data-url="{% url 'characters:xhr_add_weapons' pk=object.id %}"
                                    {% if may_edit %}
                                    data-toggle="modal"
                                    {% endif %}
                                    data-target=".character-modal"
                                    data-modal-title="{% trans 'Add Weapon' %}"
                                    href="">{% trans 'No weapons yet.' %}</a>

                        </li>
                    {% endfor %}
                </ul>
            </div>

        </div>

        <div class="col-md-6">

            <div>
                {% if may_edit %}
                <a
                        class="btn btn-primary btn-sm float-right modal-trigger"
                        data-url="{% url 'characters:xhr_add_items' pk=object.id %}"
                        title="{% trans 'Add Item' %}"
                        data-toggle="modal"
                        data-modal-title="{% trans 'Add item' %}"
                        data-target=".character-modal"
                        href=""><i class="fa fa-plus"></i></a>
                {% endif %}
                <h2 class="mb-2">{% trans 'Items' %}</h2>
            </div>
            <div class="card mb-2">
                <ul class="list-group list-group-flush">
                    {% for ci in character.characteritem_set.by_type %}
                        <li class="list-group-item">
                            <a
                                    tabindex="0"
                                    role="button"
                                    data-toggle="popover"
                                    data-html="true"
                                    data-trigger="focus"
                                    data-title="{{ ci.item }}"
                                    data-content='{% if ci.item.description %}<p>{{ ci.item.description }}</p>{% endif %}
                    <i class="fas fa-eye-slash fa-fw"></i> {% trans 'Concealment' %}: {% color_value_span ci.item.concealment 6 invert=True %}<br>
                    <i class="fas fa-balance-scale fa-fw"></i> {% trans 'Weight' %}: {{ ci.item.weight }}<br>
                    <i class="fas fa-asterisk fa-fw"></i> {% trans 'Value' %}: {% color_value_span ci.item.price 500 invert=True %} €'
                                    data-container="body">
                                {% if ci.quantity > 1 %}{% color_value_span ci.quantity 10 %}x {% endif %} {{ ci.item }} <span class="small text-muted">{{ ci.item.type }}</span>
                            </a>

                            {% if may_edit %}
                                <a class="float-right action-link text-danger" title="{% trans 'Remove / Use' %}" href="{% url 'characters:xhr_remove_item' pk=object.id item_pk=ci.id %}"><i class="fas fa-trash"></i></a>
                            {% endif %}
                        </li>
                    {% empty %}
                        <li class="list-group-item">
                            <a
                                    class="modal-trigger"
                                    data-url="{% url 'characters:xhr_add_items' pk=object.id %}"
                                    title="{% trans 'Add Item' %}"
                                    {% if may_edit %}
                                    data-toggle="modal"
                                    {% endif %}
                                    data-modal-title="{% trans 'Add item' %}"
                                    data-target=".character-modal"
                                    href="">{% trans 'No items yet.' %}</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>

        </div>
    </div>
{% endblock %}
