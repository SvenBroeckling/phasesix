{% extends 'base.html' %}
{% load i18n rules_extras characters_extras %}

{% block content %}
    <div class="row">
        <div class="col-md-10 offset-md-1 text-center">
            <div class="dropleft">
                <img data-toggle="dropdown" class="rounded-circle mb-2 img-fluid touch-menu" src="https://vignette.wikia.nocookie.net/thebiglebowski/images/7/7e/The_Dude.jpeg/revision/latest?cb=20111216183045" alt="{{ object.name }}">
                <h3 data-toggle="dropdown" class="touch-menu">{{ object.name }}</h3>
                <div class="dropdown-menu">
                    <a class="dropdown-item" href="#"><i class="fas fa-image text-info"></i> {% trans 'Change Image' %}</a>
                    <a class="dropdown-item" href="#"><i class="far fa-edit text-info"></i> {% trans 'Rename' %}</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="#"><i class="fas fa-trash text-danger"></i> {% trans 'Delete' %}</a>
                </div>

            </div>

            <div class="fragment health-fragment">
                {% include 'characters/fragments/health.html' %}
            </div>

            {% if not object.created_by %}
                <div class="alert alert-danger" role="alert">
                    {% trans 'This character was created while not being logged in. It will be deleted by tomorrow.' %}
                </div>
            {% endif %}
        </div>
    </div>
    <div class="row mt-4">
        <div class="col-md-10 offset-md-1">
            <ul class="nav nav-tabs nav-fill mb-4">
                <li class="nav-item">
                    <a class="nav-link active" data-toggle="tab" href="#v-character" role="tab">{% trans 'Character' %}</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#v-gear" role="tab">{% trans 'Gear' %}</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#v-background" role="tab">{% trans 'Background' %}</a>
                </li>
            </ul>

            <div class="tab-content">
                <div class="tab-pane fade show active" id="v-character" role="tabpanel">
                    {% include 'characters/fragments/character.html' %}
                </div>

                <div class="tab-pane fade" id="v-gear" role="tabpanel">
                    <div class="row">
                        <div class="col-md-6">

                            <div class="dropdown">
                                <h2 data-toggle="dropdown" class="mb-1 text-center touch-menu">- {% trans 'Amor' %} -</h2>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" href="#"><i class="fas fa-plus text-info"></i> {% trans 'Add Armor' %}</a>
                                </div>
                            </div>

                            <div class="row">
                                {% for r in character.characterriotgear_set.all %}
                                    <div class="col-md-6 dropright">
                                        <div class="card mb-2 touch-menu" data-toggle="dropdown">
                                            <div class="card-header">
                                                {{ r.riot_gear }}
                                            </div>
                                            <div class="card-body">
                                                <i class="fas fa-shield-alt"></i> {% trans 'Protection' %}: {% color_value_span r.riot_gear.protection_ballistic 7 %}/{% color_value_span r.riot_gear.protection_explosive 7 %}<br>
                                                <i class="fas fa-eye-slash"></i> {% trans 'Concealment' %}: {% color_value_span r.riot_gear.concealment 6 invert=True %}<br>
                                                <i class="fas fa-balance-scale"></i> {% trans 'Weight' %}: {{ r.riot_gear.weight }}<br>
                                                <i class="fas fa-asterisk"></i> {% trans 'Condition' %}: {% color_value_span r.condition 100 %}
                                            </div>
                                        </div>
                                        <div class="dropdown-menu">
                                            <a class="dropdown-item" href="#"><i class="fas fa-times text-warning"></i> {% trans 'Damage' %}</a>
                                            <a class="dropdown-item" href="#"><i class="fas fa-trash text-danger"></i> {% trans 'Remove' %}</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="#"><i class="fas fa-plus text-info"></i> {% trans 'Add Armor' %}</a>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h2 class="mb-1 text-center">- {% trans 'Items' %} -</h2>
                            <div class="row">
                                {% for ci in character.characteritem_set.by_type %}
                                    <div class="col-md-6">
                                        <div class="card mb-2">
                                            <div class="card-header">
                                                {{ ci.item }}
                                                <span class="float-right small">{{ ci.item.type }}</span>
                                            </div>
                                            <div class="card-body">
                                                <i class="fas fa-eye-slash"></i> {% trans 'Concealment' %}: {% color_value_span ci.item.concealment 6 invert=True %}<br>
                                                <i class="fas fa-balance-scale"></i> {% trans 'Weight' %}: {{ ci.item.weight }}<br>
                                                <i class="fas fa-asterisk"></i> {% trans 'Value' %}: {% color_value_span ci.item.price 500 invert=True %} â‚¬
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <h2 class="mb-1 text-center">- {% trans 'Weapons' %} -</h2>
                            <div class="row">
                                {% for weapon in object.characterweapon_set.all %}
                                <div class="col-md-6">
                                    <div class="card mb-2">
                                        <div class="card-header">
                                            {{ weapon.weapon }}
                                            <span class="float-right small">{{ weapon.weapon.type }}</span>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <i class="fas fa-times"></i> {% trans 'Attacks / Action' %}: {% color_value_span weapon.weapon.attacks_per_action 8 %} {% display_modifications weapon 'attacks_per_action' %}<br>
                                                    <i class="fas fa-bullseye"></i> {% trans 'Accuracy' %}: {% color_value_span weapon.weapon.accuracy 4 %} {% display_modifications weapon 'accuracy' %}<br>
                                                    <i class="fas fa-angle-double-right"></i> {% trans 'Penetration' %}: {% color_value_span weapon.weapon.penetration 4 %} {% display_modifications weapon 'penetration' %}<br>
                                                    <i class="fas fa-heart"></i> {% trans 'Wound bonus' %}: {% color_value_span weapon.weapon.wound_bonus 4 %} {% display_modifications weapon 'wound_bonus' %}<br>
                                                    <i class="fas fa-clock"></i> {% trans 'Reload actions' %}: {% color_value_span weapon.weapon.reload_actions 6 invert=True %} {% display_modifications weapon 'reload_actions' %}<br>
                                                    <i class="fas fa-arrow-circle-left"></i> {% trans 'Recoil control' %}: {% color_value_span weapon.weapon.recoil_control 4 %} {% display_modifications weapon 'recoil_control' %}<br>
                                                    <i class="fas fa-arrows-alt-h"></i> {% trans 'Range' %}: {{ weapon.weapon.get_range_lower_display }}
                                                    {% if weapon.weapon.range_upper and weapon.weapon.range_upper != weapon.weapon.range_lower %}-
                                                        {{ weapon.weapon.get_range_upper_display }}{% endif %}<br>
                                                </div>
                                                <div class="col-md-6">
                                                    <i class="fas fa-eye-slash"></i> {% trans 'Concealment' %}: {% color_value_span weapon.weapon.concealment 7 invert=True %} {% display_modifications weapon 'concealment' %}<br>
                                                    <i class="fas fa-balance-scale"></i> {% trans 'Weight' %}: {{ weapon.weapon.weight }} {% display_modifications weapon 'weight' %}<br>
                                                    <i class="fas fa-list-ol"></i> {% trans 'Capacity' %}: {% color_value_span weapon.weapon.capacity 30 %}<br>
                                                    {% if weapon.weapon.attack_modes.exists %}
                                                        <br>
                                                        {% for fm in weapon.weapon.attack_modes.all %}{{ fm }}<br>{% endfor %}
                                                    {% endif %}
                                                    {% if weapon.modifications.exists %}
                                                        <br><br>
                                                        {% for wm in weapon.modifications.all %}
                                                            {{ wm }}<br>
                                                        {% endfor %}
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="v-background" role="tabpanel">
                    <div class="row">
                        <div class="col-md-12">
                            <h2 class="mb-1 text-center">- {% trans 'Background' %} -</h2>
                        </div>
                        {% for template in character.charactertemplate_set.all %}
                            <div class="col-md-4">
                                {% template_widget template.template %}
                            </div>
                        {% endfor %}
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <h2 class="mb-1 text-center">- {% trans 'Advancement' %} -</h2>
                            soon...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
