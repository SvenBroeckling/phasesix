{% extends 'base.html' %}
{% load i18n rules_extras characters_extras campaign_extras thumbnail static %}

{% block title %}{{ object }} - {{ block.super }}{% endblock %}

{% block javascript %}
    <script src="{% static 'js/character_detail.js' %}"></script>
    <script src="{% static 'js/campaign_socket.js' %}"></script>
{% endblock %}

{% block belownav %}
    <div
            class="row character-info-row"
            style="
                    {% if character.backdrop_image %}
                        {% thumbnail character.backdrop_image "1800" as im %}
                            background-image: url({{ im.url }})
                        {% endthumbnail %}
                    {% else %}
                        {% if character.get_epoch.image %}
                            {% thumbnail character.get_epoch.image "1800" as im %}
                                background-image: url({{ im.url }})
                            {% endthumbnail %}
                        {% else %}
                            background-color: silver
                        {% endif %}
                    {% endif %}">

        <div class="col-md-10 offset-md-1 pb-5 d-flex">

            <div class="card">
                <div class="card-body d-flex flex-wrap">
                    <div class="character-image me-4 {% if may_edit %}sidebar-trigger{% endif %}"
                         data-sidebar-title="{% trans 'Character' %}"
                         data-sidebar-url="{% url 'characters:xhr_character_sidebar' pk=object.id sidebar_template="character" %}">
                        <img class="rounded img-fluid" src="{{ object.get_image_url }}" alt="{{ object.name }}">
                        <span class="dice-icon"><i class="fas fa-dice-five text-light shadow fa-2x"></i></span>
                    </div>
                    <div class="mt-3 mt-sm-0">
                        <h3 class="mb-0">{{ object.name }}</h3>
                        <small><span>{{ object.lineage }}</span></small><br>
                        {% template_category_string object 3 %}
                        {% template_category_string object 2 %}
                        {% if object.pc_or_npc_campaign %}
                            <small>{% trans 'Campaign' %}: <a href="{% url 'campaigns:detail' pk=object.pc_or_npc_campaign.id %}">{{ object.pc_or_npc_campaign }}</a></small>
                            <br>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

    </div>
{% endblock %}

{% block content %}
    <div class="d-none" id="room-url">{% ws_room_url object.ws_room_name %}</div>
    <audio class="d-none" id="room-audio" src="{% static 'roll.mp3' %}"></audio>

    <div class="row mt-4">

        <div class="col-12">
            {% detail_fragment 'health' %}

            <div class="nav nav-tabs justify-content-center mb-3" id="v-pills-tab" role="tablist">
                <a class="nav-link active" data-bs-toggle="tab" href="#v-character"
                   role="tab" aria-controls="v-character" aria-selected="true"><i
                        class="fas fa-fw fa-male"></i>&nbsp;{% trans 'Character' %}</a>
                <a class="nav-link" data-bs-toggle="tab" href="#v-gear" role="tab" aria-controls="v-gear"
                   aria-selected="true"><i class="fas fa-suitcase fa-fw"></i>&nbsp;{% trans 'Gear' %}</a>
                <a class="nav-link" data-bs-toggle="tab" href="#v-combat" role="tab" aria-controls="v-combat"
                   aria-selected="true"><i class="fas fa-fw fa-chess-pawn"></i>&nbsp;{% trans 'Combat' %}</a>
                {% if object.extension_enabled.magic %}
                    <a class="nav-link" data-bs-toggle="tab" href="#v-magic" role="tab" aria-controls="v-combat"
                       aria-selected="true"><i class="fas fa-fw fa-magic"></i>&nbsp;{% trans 'Magic' %}
                        {% if object.spell_points_available %}
                            <span class="badge bg-info ms-2">{{ object.spell_points_available }}</span>
                        {% endif %}
                    </a>
                {% endif %}
                <a class="nav-link" data-bs-toggle="tab" href="#v-background" role="tab" aria-controls="v-background"
                   aria-selected="true"><i class="fas fa-fw fa-graduation-cap"></i>&nbsp;{% trans 'Background' %}
                    <span class="badge bg-primary ms-2">{{ object.reputation_available }}/{{ object.reputation_gained }}</span>
                </a>
                <a class="nav-link" data-bs-toggle="tab" href="#v-notes" role="tab" aria-controls="v-notes"
                   aria-selected="true"><i class="fas fa-fw fa-feather"></i>&nbsp;{% trans 'Notes' %}
                    {% if may_edit %}
                        <button type="button" class="btn btn-primary btn-sm ms-2 sidebar-trigger" data-sidebar-title="{% trans 'Take a note' %}" data-sidebar-url="{% url 'characters:xhr_character_sidebar' pk=object.id sidebar_template="createnote" %}">+</button>
                    {% endif %}
                </a>
            </div>

            {% if not object.created_by %}
                <div class="alert alert-danger" role="alert">
                    {% trans 'This character was created while not being logged in. It will be deleted by tomorrow.' %}
                </div>
            {% endif %}

            <div class="tab-content">
                <div class="tab-pane fade show active" id="v-character" role="tabpanel">
                    {% detail_fragment 'character' %}
                </div>

                <div class="tab-pane fade" id="v-gear" role="tabpanel">
                    {% detail_fragment 'gear' %}
                </div>

                <div class="tab-pane fade" id="v-combat" role="tabpanel">
                    {% detail_fragment 'combat' %}
                </div>

                <div class="tab-pane fade" id="v-magic" role="tabpanel">
                    {% detail_fragment 'magic' %}
                </div>

                <div class="tab-pane fade" id="v-background" role="tabpanel">
                    {% detail_fragment 'advancement' %}
                </div>

                <div class="tab-pane fade" id="v-notes" role="tabpanel">
                    {% detail_fragment 'notes' %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}
