{% extends 'base.html' %}
{% load i18n rules_extras characters_extras %}

{% block content %}
    <div class="row">
        <div class="col-md-10 offset-md-1 text-center">
            <img class="rounded-circle mb-2 img-fluid" src="https://vignette.wikia.nocookie.net/thebiglebowski/images/7/7e/The_Dude.jpeg/revision/latest?cb=20111216183045" alt="{{ object.name }}">
            <h3>{{ object.name }}</h3>
            {% if not object.created_by %}
                <div class="alert alert-danger" role="alert">
                    {% trans 'This character was created while not being logged in. It will be deleted by tomorrow.' %}
                </div>
            {% endif %}
        </div>
    </div>
    <div class="row mt-4">
        <div class="col-md-10 offset-md-1">
            <ul class="nav nav-tabs nav-fill mb-4">
                <li class="nav-item">
                    <a class="nav-link active" data-toggle="tab" href="#v-character" role="tab">{% trans 'Character' %}</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#v-gear" role="tab">{% trans 'Gear' %}</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#v-background" role="tab">{% trans 'Background' %}</a>
                </li>
            </ul>

            <div class="tab-content">
                <div class="tab-pane fade show active" id="v-character" role="tabpanel">
                    <div class="row">
                        <div class="col-md-12 text-center mb-1">
                            <h2>- {% trans 'Persona' %} -</h2>
                        </div>
                        <div class="col-sm-6 col-md-4 col-xl-2">
                            {% trans 'Openness' as attribute_name %}
                            {% character_attribute_widget attribute_name object.openness %}
                        </div>
                        <div class="col-sm-6 col-md-4 col-xl-2">
                            {% trans 'Conscientiousness' as attribute_name %}
                            {% character_attribute_widget attribute_name object.conscientiousness %}
                        </div>
                        <div class="col-sm-6 col-md-4 col-xl-2">
                            {% trans 'Extraversion' as attribute_name %}
                            {% character_attribute_widget attribute_name object.extraversion %}
                        </div>
                        <div class="col-sm-6 col-md-4 col-xl-2">
                            {% trans 'Agreeableness' as attribute_name %}
                            {% character_attribute_widget attribute_name object.agreeableness %}
                        </div>
                        <div class="col-sm-6 col-md-4 col-xl-2">
                            {% trans 'Neuroticism' as attribute_name %}
                            {% character_attribute_widget attribute_name object.neuroticism %}
                        </div>
                        <div class="col-sm-6 col-md-4 col-xl-2">
                            {% trans 'IQ' as attribute_name %}
                            {% character_attribute_widget attribute_name object.intelligence %}
                        </div>
                    </div>


                    <div class="row">
                        <div class="col-md-12 text-center mb-1">
                            <h2>- {% trans 'Physis' %} -</h2>
                        </div>
                        <div class="col-sm-6 col-md-4 col-xl-2">
                            {% trans 'Deftness' as attribute_name %}
                            {% character_attribute_widget attribute_name object.deftness %}
                        </div>
                        <div class="col-sm-6 col-md-4 col-xl-2">
                            {% trans 'Strength' as attribute_name %}
                            {% character_attribute_widget attribute_name object.strength %}
                        </div>
                        <div class="col-sm-6 col-md-4 col-xl-2">
                            {% trans 'Attractiveness' as attribute_name %}
                            {% character_attribute_widget attribute_name object.attractiveness %}
                        </div>
                        <div class="col-sm-6 col-md-4 col-xl-2">
                            {% trans 'Endurance' as attribute_name %}
                            {% character_attribute_widget attribute_name object.endurance %}
                        </div>
                        <div class="col-sm-6 col-md-4 col-xl-2">
                            {% trans 'Resistance' as attribute_name %}
                            {% character_attribute_widget attribute_name object.resistance %}
                        </div>
                        <div class="col-sm-6 col-md-4 col-xl-2">
                            {% trans 'Quickness' as attribute_name %}
                            {% character_attribute_widget attribute_name object.quickness %}
                        </div>
                    </div>

                    <div class="row mt-2">
                        <div class="col-md-4 mb-1">
                            <h2 class="mb-1 text-center">- {% trans 'Mind Skills' %} -</h2>
                            <table class="table">
                                {% for skill in object.characterskill_set.mind_skills %}
                                    <tr>
                                        <td>{{ skill.skill }}</td>
                                        <td class="text-right">{% color_value_span skill.value 6 %}</td>
                                    </tr>
                                {% endfor %}
                            </table>
                        </div>

                        <div class="col-md-4 mb-1">
                            <h2 class="text-center mb-1">- {% trans 'Practical Skills' %} -</h2>
                            <table class="table">
                                {% for skill in object.characterskill_set.practical_skills %}
                                    <tr>
                                        <td>{{ skill.skill }}</td>
                                        <td class="text-right">{% color_value_span skill.value 6 %}</td>
                                    </tr>
                                {% endfor %}
                            </table>
                        </div>
                        <div class="col-md-4 mb-1">
                            <h2 class="text-center mb-1">- {% trans 'Dice' %} -</h2>
                            <table class="table">
                                <tr>
                                    <td>{% trans 'Bonus Dice' %}</td>
                                    <td class="text-right">{% color_value_span object.bonus_dice 6 %}</td>
                                </tr>
                                <tr>
                                    <td>{% trans 'Destiny Dice' %}</td>
                                    <td class="text-right">{% color_value_span object.destiny_dice 6 %}</td>
                                </tr>
                                <tr>
                                    <td>{% trans 'Rerolls' %}</td>
                                    <td class="text-right">{% color_value_span object.rerolls 6 %}</td>
                                </tr>
                            </table>

                            {% if object.characterknowledge_set.exists %}
                                <h2 class="text-center mb-1">- {% trans 'Knowledge' %} -</h2>
                                <table class="table">
                                    {% for knowledge in object.characterknowledge_set.all %}
                                        <tr>
                                            <td>{{ knowledge.knowledge }}</td>
                                            <td class="text-right">{% color_value_span knowledge.value 6 %}</td>
                                        </tr>
                                    {% endfor %}
                                </table>
                            {% endif %}

                            {% if object.shadows.exists %}
                            <h2 class="text-center mb-1">- {% trans 'Shadows' %} -</h2>
                            <div class="card mb-2">
                                <div class="card-body">
                                    {% for shadow in object.shadows.all %}
                                    {{ shadow }}<br>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}

                            {% if object.contacts.exists %}
                            <h2 class="text-center mb-1">- {% trans 'Contacts' %} -</h2>
                            <div class="card mb-2">
                                <div class="card-body">
                                    {% for contact in object.contacts.all %}
                                    {{ contact }}<br>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}
                        </div>

                    </div>
                </div>

                <div class="tab-pane fade" id="v-gear" role="tabpanel">
                    <div class="row">
                        <div class="col-md-7">
                            {% comment %}
                                    {% if character.created_by == user %}
                                        <button class="btn btn-primary btn-sm float-right buy-button"
                                                data-buy-url="{% url 'characters:xhr_buy_riot_gear' pk=object.id %}"
                                                data-modal-title="{% trans 'Buy riot gear' %}"
                                                data-toggle="modal"
                                                data-target=".creation-modal">{% trans 'Buy riot gear' %}
                                        </button>
                                    {% endif %}
                                    {% endcomment %}
                            <h2 class="mb-1 text-center">- {% trans 'Amor' %} -</h2>
                            <table class="table">
                                <thead>
                                <tr>
                                    <th>{% trans 'Riot gear' %}</th>
                                    <th title="{% trans 'Ballistic/Explosive' %}">{% trans 'Protection' %}</th>
                                    <th>{% trans 'Weight' %}</th>
                                    <th>{% trans 'Condition' %}</th>

                                    <th></th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for r in character.characterriotgear_set.all %}
                                    <tr>
                                        <td>{{ r.riot_gear }}</td>
                                        <td>{% color_value_span r.riot_gear.protection_ballistic 7 %}/{% color_value_span r.riot_gear.protection_explosive 7 %}</td>
                                        <td>{{ r.riot_gear.weight }}</td>
                                        <td>{% color_value_span r.condition 100 %}</td>
                                        <td>
                                            {% comment %}
                                            {% if character.created_by == user %}
                                                <form action="{% url 'characters:sell_riot_gear' pk=character.id riot_gear_pk=r.id %}"
                                                      class="pull-right" method="post">
                                                    {% csrf_token %}
                                                    <input type="hidden" name="riot_gear_id" value="{{ r.id }}">
                                                    <button class="btn btn-sm btn-primary float-right">{% trans 'Sell' %} {{ r.riot_gear.price }} €</button>
                                                </form>
                                            {% endif %}
                                            {% endcomment %}
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div class="col-md-5">
                            <h2 class="mb-1 text-center">- {% trans 'Items' %} -</h2>
                            <table class="table">
                                <tr>
                                    <th>{{ ci.item.type }}</th>
                                    <th>Con.</th>
                                    <th>Weight</th>
                                    <th>#</th>
                                    <th></th>
                                </tr>
                                {% for ci in character.characteritem_set.by_type %}
                                    <tr>
                                        <td>{{ ci.item }}</td>
                                        <td>{% color_value_span ci.item.concealment 6 invert=True %}</td>
                                        <td>{{ ci.item.weight }}</td>
                                        <td>{{ ci.quantity }}</td>
                                        <td>
                                            {% comment %}
                                            {% if character.created_by == user %}
                                                <form action="{% url 'characters:sell_item' pk=character.id item_pk=ci.id %}"
                                                      class="pull-right" method="post">
                                                    {% csrf_token %}
                                                    <button class="btn btn-sm btn-primary float-right">{% trans 'Sell' %} {{ ci.item.price }} €</button>
                                                </form>
                                            {% endif %}
                                            {% endcomment %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </table>
                            {% comment %}
                                    {% if character.created_by == user %}
                                        <button class="btn btn-primary btn-xs pull-right buy-button"
                                                data-buy-url="{% url 'characters:xhr_buy_items' pk=object.id %}"
                                                data-modal-title="{% trans 'Buy items' %}"
                                                data-toggle="modal"
                                                data-target=".creation-modal">{% trans 'Buy items' %}</button>
                                    {% endif %}
                            {% endcomment %}
                        </div>
                    </div>

                {% comment %}
                    {% if character.created_by == user %}
                        <button
                                class="btn btn-primary buy-button"
                                data-buy-url="{% url 'characters:xhr_buy_weapons' pk=object.id %}"
                                data-toggle="modal"
                                data-modal-title="{% trans 'Buy weapons' %}"
                                data-target=".creation-modal">{% trans 'Buy weapons' %}</button>
                    {% endif %}
                {% endcomment %}

                    <div class="row">
                        {% for weapon in object.characterweapon_set.all %}
                            <div class="col-md-6">
                                <h2 class="mb-1 text-center">- {{ weapon.weapon }} -</h2>
                                <table class="table">
                                    <tr>
                                        <th>{% trans 'Type' %}</th>
                                        <td>{{ weapon.weapon.type }}</td>
                                        <th>{% trans 'Attacks / Action' %}</th>
                                        <td>{% color_value_span weapon.weapon.attacks_per_action 8 %} {% display_modifications weapon 'attacks_per_action' %}</td>
                                    </tr>
                                    <tr>
                                        <th>{% trans 'Range' %}</th>
                                        <td>{{ weapon.weapon.get_range_lower_display }}
                                            {% if weapon.weapon.range_upper and weapon.weapon.range_upper != weapon.weapon.range_lower %}-
                                                {{ weapon.weapon.get_range_upper_display }}{% endif %}</td>
                                        <th>{% trans 'Accuracy' %}</th>
                                        <td>{% color_value_span weapon.weapon.accuracy 4 %} {% display_modifications weapon 'accuracy' %}</td>
                                    </tr>
                                    <tr>
                                        <th>{% trans 'Penetration' %}</th>
                                        <td>{% color_value_span weapon.weapon.penetration 4 %} {% display_modifications weapon 'penetration' %}</td>
                                        <th>{% trans 'Wound bonus' %}</th>
                                        <td>{% color_value_span weapon.weapon.wound_bonus 4 %} {% display_modifications weapon 'wound_bonus' %}</td>
                                    </tr>
                                    <tr>
                                        <th>{% trans 'Recoil control' %}</th>
                                        <td>{% color_value_span weapon.weapon.recoil_control 4 %} {% display_modifications weapon 'recoil_control' %}</td>
                                        <th>{% trans 'Concealment' %}</th>
                                        <td>{% color_value_span weapon.weapon.concealment 7 invert=True %} {% display_modifications weapon 'concealment' %}</td>
                                    </tr>
                                    {% if not weapon.weapon.is_hand_to_hand_weapon %}
                                    <tr>
                                        <th>{% trans 'Reload actions' %}</th>
                                        <td>{% color_value_span weapon.weapon.reload_actions 6 invert=True %} {% display_modifications weapon 'reload_actions' %}</td>
                                        <th>{% trans 'Capacity' %}</th>
                                        <td>{% color_value_span weapon.weapon.capacity 30 %}</td>
                                    </tr>
                                    {% endif %}
                                    <tr>
                                        <th>{% trans 'Attack modes' %}</th>
                                        <td>{% for fm in weapon.weapon.attack_modes.all %}{{ fm }}<br>{% endfor %}</td>
                                        <th>{% trans 'Weight' %}</th>
                                        <td>{{ weapon.weapon.weight }} {% display_modifications weapon 'weight' %}</td>
                                    </tr>
                                    <tr>
                                        <th>{% trans 'Modifications' %}</th>
                                        <td>
                                            {% for wm in weapon.modifications.all %}
                                                {{ wm }}<br>
                                            {% endfor %}
                                        {% comment %}
                                            <button
                                                    class="btn btn-primary btn-xs buy-button"
                                                    data-buy-url="{% url 'characters:xhr_buy_weapon_modifications' pk=object.id %}?weapon_id={{ weapon.id }}"
                                                    data-toggle="modal"
                                                    data-modal-title="{% trans 'Buy weapon modification' %}"
                                                    data-target=".creation-modal">{% trans 'Buy weapon modification' %}</button>
                                                    {% endcomment %}
                                        </td>
                                        <th></th>
                                        <td></td>
                                    </tr>
                                </table>
                            </div>
                        {% endfor %}
                    </div>

                </div>

                <div class="tab-pane fade" id="v-background" role="tabpanel">
                    <div class="row">
                        {% for template in character.charactertemplate_set.all %}
                            <div class="col-md-4">
                                {% template_widget template.template %}
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
