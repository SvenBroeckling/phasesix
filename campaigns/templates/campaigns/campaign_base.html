{% extends 'base.html' %}
{% load i18n thumbnail static rules_extras campaign_extras %}

{% block title %}{{ object }} - {{ block.super }}{% endblock %}

{% block javascript %}
    <script src="{% static 'js/campaign_socket.js' %}"></script>
    <script src="{% static 'js/sidebar.js' %}"></script>
    <script src="{% static 'js/clipboard.js' %}"></script>
    <script>
        $('.campaign-link').on('click', function (e) {
            let elem = $(this)
            let orig_text = elem.text()
            copyTextToClipboard(elem.attr('href'))

            elem.text(elem.data('msg'))
            setTimeout(() => elem.text(orig_text), 1000)

            e.preventDefault()
            return false
        })

        $('table.campaign-status-sortable').tablesorter({
            textExtraction: {
                '.data': function(node, table, cellIndex) {
                    return $(node).find('span.sort-key').text()
                }
            }
        })
    </script>
{% endblock %}

{% block belownav %}
    <div
            class="row campaign-info-row"
            style="
                    {% if object.backdrop_image %}
                        background-image: url({{ object.backdrop_image.url }})
                    {% else %}
                        {% if object.epoch.image %}
                            background-image: url({{ object.epoch.image.url }})
                        {% else %}
                            background-color: silver
                        {% endif %}
                    {% endif %}">
        <div class="col-md-10 offset-md-1 info mt-4">
            <a
                    href=""
                    data-sidebar-title="{% trans 'Roll' %}"
                    data-sidebar-url="{% url 'campaigns:xhr_sidebar' pk=object.id sidebar_name="roll"%}"
                    class="sidebar-trigger btn btn-primary float-end"><i class="fas fa-dice-five"></i> {% trans 'Roll' %}</a>
            <a href="{{ object.get_invite_link }}" class="btn campaign-link btn-primary float-end me-2"
               data-msg="{% trans 'Copied' %}">{% trans 'Invite Link' %}</a>
            <h1>{{ object.name }}</h1>
            {% trans 'A campaign by' %} {{ object.created_by }}
        </div>
    </div>
{% endblock %}

{% block content %}
    <div class="d-none" id="room-url">{% ws_room_url object.ws_room_name %}</div>
    <audio class="d-none" id="room-audio" src="{% static 'roll.mp3' %}"></audio>
    <div class="row mt-4">

        <div class="col-lg-2 col-md-3">
            <div class="nav flex-column nav-pills mb-2" aria-orientation="vertical">
                <a class="nav-link {% if active_tab == 'detail' %}active{% endif %}"
                   href="{% url 'campaigns:detail' pk=object.id %}">
                    <i class="fas fa-fw fa-people-carry"></i>&nbsp;{% trans 'Campaign' %}
                </a>

                {% if active_tab == 'invitation' %}
                    <a class="nav-link active" href="">
                        <i class="fas fa-fw fa-people-carry"></i>&nbsp;{% trans 'Join' %}
                    </a>
                {% endif %}

                {% if may_edit %}
                    <a class="nav-link {% if active_tab == 'status' %}active{% endif %}"
                       href="{% url 'campaigns:status' pk=object.id %}">
                        <i class="fas fa-fw fa-cube"></i>&nbsp;{% trans 'Status' %}
                    </a>
                    <a class="nav-link {% if active_tab == 'update' %}active{% endif %}"
                       href="{% url 'campaigns:update' pk=object.id %}">
                        <i class="fas fa-fw fa-edit"></i>&nbsp;{% trans 'Settings' %}
                    </a>
                    <a class="nav-link {% if active_tab == 'scenes' %}active{% endif %}"
                       href="{% url 'campaigns:scenes' pk=object.id %}">
                        <i class="fas fa-fw fa-cube"></i>&nbsp;{% trans 'Scenes' %}
                    </a>
                {% endif %}
            </div>
        </div>

        <div class="col-lg-10 col-md-9">
            {% block campaign_content %}
            {% endblock %}
        </div>
    </div>
{% endblock %}
